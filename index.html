<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Vidriería</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos para el modal de revisión */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2.5rem;
            border-radius: 1.5rem;
            width: 90%;
            max-width: 500px;
            max-height: 80%;
            overflow-y: auto;
            position: relative;
        }
    </style>
</head>
<body class="bg-gradient-to-r from-blue-400 to-purple-500 flex items-center justify-center min-h-screen p-4">

    <!-- Main card container -->
    <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md transform transition-all duration-300 hover:scale-105">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">VIDRIERIA TAURO (COTIZACION DE VIDRIOS)</h1>
        <p class="text-center text-gray-600 mb-8">
            Obtén una estimación de precio al instante y envíala por WhatsApp.
        </p>

        <!-- Items container where new input groups will be added -->
        <div id="items-container" class="mt-6 space-y-4">
            <!-- Initial item row -->
            <div class="item-row grid grid-cols-6 gap-2 items-center">
                <div class="col-span-2">
                    <label class="block text-xs font-medium text-gray-500 mb-1">Tipo de Vidrio</label>
                    <select class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition-colors duration-200 p-1 text-sm glass-type-select">
                        <option value="incoloro_3mm" selected>Incoloro (3mm)</option>
                        <option value="incoloro_4mm">Incoloro (4mm)</option>
                    </select>
                </div>
                <div class="col-span-1">
                    <label class="block text-xs font-medium text-gray-500 mb-1">Cant.</label>
                    <input type="number" placeholder="1" value="1" min="1" class="w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2 text-sm quantity-input">
                </div>
                <div class="col-span-1">
                    <label class="block text-xs font-medium text-gray-500 mb-1">Ancho (cm)</label>
                    <input type="number" placeholder="Ej: 80" class="w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2 text-sm width-input" required min="1">
                </div>
                <div class="col-span-1">
                    <label class="block text-xs font-medium text-gray-500 mb-1">Alto (cm)</label>
                    <input type="number" placeholder="Ej: 150" class="w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2 text-sm height-input" required min="1">
                </div>
                <div class="col-span-1 flex justify-end">
                    <button class="remove-btn bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl font-bold opacity-0 transition-opacity duration-200 cursor-pointer hover:bg-red-600">
                        -
                    </button>
                </div>
            </div>
        </div>

        <!-- Add item button -->
        <button id="addItemBtn" class="mt-4 w-full bg-blue-500 text-white font-semibold py-2 px-4 rounded-xl shadow-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
            Agregar otro artículo
        </button>

        <!-- Calculation button -->
        <button id="calculateBtn" class="mt-4 w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
            Calcular Precio Total
        </button>

        <!-- Result section -->
        <div id="result" class="mt-8 text-center bg-gray-50 rounded-lg p-6 border-2 border-gray-200 hidden">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">Precio Total Estimado</h3>
            <p class="text-4xl font-extrabold text-blue-600">
                <span id="priceDisplay"></span>
            </p>
            <p id="message" class="text-sm text-gray-500 mt-2"></p>
            
            <!-- WhatsApp section -->
            <div id="whatsapp-section" class="mt-6 hidden">
                <label for="clientName" class="block text-sm font-medium text-gray-700 mb-1">Tu Nombre</label>
                <input type="text" id="clientName" placeholder="Ej: Juan Pérez" class="w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring focus:ring-green-500 focus:ring-opacity-50 p-2 text-sm mb-3">
                <label for="whatsappNumber" class="block text-sm font-medium text-gray-700 mb-1">Tu Número de WhatsApp</label>
                <input type="tel" id="whatsappNumber" placeholder="Ej: 51912345678" class="w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring focus:ring-green-500 focus:ring-opacity-50 p-2 text-sm" required>
                
                <button id="reviewBtn" class="mt-3 w-full bg-yellow-500 text-white font-semibold py-2 px-4 rounded-xl shadow-md hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition-colors duration-200">
                    Revisión de Cotización
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de revisión de cotización -->
    <div id="review-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Revisión de Cotización</h2>
            <div id="review-details" class="space-y-4">
                <!-- Los detalles de la cotización se insertarán aquí dinámicamente -->
            </div>
            <div class="mt-6 text-center">
                <p class="text-xl font-bold text-gray-800">Total: <span id="review-total-price" class="text-blue-600"></span></p>
            </div>
            <button id="closeModalBtn" class="mt-6 w-full bg-gray-400 text-white font-semibold py-2 px-4 rounded-xl shadow-md hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-colors duration-200">
                Cerrar
            </button>
            <button id="sendWhatsappBtn" class="mt-3 w-full bg-green-500 text-white font-semibold py-2 px-4 rounded-xl shadow-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200">
                Enviar cotización por WhatsApp
            </button>
        </div>
    </div>

    <!-- Template for new item rows -->
    <template id="item-template">
        <div class="item-row grid grid-cols-6 gap-2 items-center">
            <div class="col-span-2">
                <label class="block text-xs font-medium text-gray-500 mb-1">Tipo de Vidrio</label>
                <select class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 transition-colors duration-200 p-1 text-sm glass-type-select">
                    <option value="incoloro_3mm" selected>Incoloro (3mm)</option>
                    <option value="incoloro_4mm">Incoloro (4mm)</option>
                </select>
            </div>
            <div class="col-span-1">
                <label class="block text-xs font-medium text-gray-500 mb-1">Cant.</label>
                <input type="number" placeholder="1" value="1" min="1" class="w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2 text-sm quantity-input">
            </div>
            <div class="col-span-1">
                <label class="block text-xs font-medium text-gray-500 mb-1">Ancho (cm)</label>
                <input type="number" placeholder="Ej: 80" class="w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2 text-sm width-input" required min="1">
            </div>
            <div class="col-span-1">
                <label class="block text-xs font-medium text-gray-500 mb-1">Alto (cm)</label>
                <input type="number" placeholder="Ej: 150" class="w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2 text-sm height-input" required min="1">
            </div>
            <div class="col-span-1 flex justify-end">
                <button class="remove-btn bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl font-bold opacity-0 transition-opacity duration-200 cursor-pointer hover:bg-red-600">
                    -
                </button>
            </div>
        </div>
    </template>

    <script>
        // ESTA ES LA SECCION DONDE PUEDES CAMBIAR LOS PRECIOS
        // ADVERTENCIA: Estos valores son PUBLICOS. Cualquier persona con conocimientos tecnicos
        // puede ver y cambiar estos precios en su navegador.
        // Si necesitas una seguridad absoluta, se requiere un servidor (backend) para guardar los precios.
        const glassData = {
            incoloro_3mm: { name: 'Incoloro (3mm)', price: 1.8 },
            incoloro_4mm: { name: 'Incoloro (4mm)', price: 2.1 },
            incoloro_5mm: { name: 'Incoloro (5mm)', price: 2.4 }

        };

        const calculateBtn = document.getElementById('calculateBtn');
        const addItemBtn = document.getElementById('addItemBtn');
        const itemsContainer = document.getElementById('items-container');
        const itemTemplate = document.getElementById('item-template');
        const resultDiv = document.getElementById('result');
        const priceDisplay = document.getElementById('priceDisplay');
        const messageDisplay = document.getElementById('message');
        const whatsappSection = document.getElementById('whatsapp-section');
        const clientNameInput = document.getElementById('clientName');
        const whatsappNumberInput = document.getElementById('whatsappNumber');
        const reviewBtn = document.getElementById('reviewBtn');
        const reviewModal = document.getElementById('review-modal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const reviewDetails = document.getElementById('review-details');
        const reviewTotalPrice = document.getElementById('review-total-price');
        const sendWhatsappBtn = document.getElementById('sendWhatsappBtn');

        let totalGeneralPrice = 0;
        let quoteDetails = [];

        // Initial setup for the first row's remove button opacity
        const initialRemoveBtn = document.querySelector('.item-row .remove-btn');
        initialRemoveBtn.style.opacity = '0';
        initialRemoveBtn.style.cursor = 'default';

        // Add a new item row to the container
        addItemBtn.addEventListener('click', () => {
            const newItemRow = itemTemplate.content.cloneNode(true);
            const removeBtn = newItemRow.querySelector('.remove-btn');
            removeBtn.style.opacity = '1';
            removeBtn.style.cursor = 'pointer';
            itemsContainer.appendChild(newItemRow);
        });

        // Event delegation for the remove buttons
        itemsContainer.addEventListener('click', (event) => {
            if (event.target.classList.contains('remove-btn')) {
                const itemRow = event.target.closest('.item-row');
                if (itemsContainer.children.length > 1) {
                    itemRow.remove();
                }
            }
        });
        
        // Main calculation logic
        calculateBtn.addEventListener('click', () => {
            const itemRows = itemsContainer.querySelectorAll('.item-row');
            totalGeneralPrice = 0;
            quoteDetails = [];
            let hasError = false;

            // Loop through each item row
            itemRows.forEach(itemRow => {
                const quantityInput = itemRow.querySelector('.quantity-input');
                const widthInput = itemRow.querySelector('.width-input');
                const heightInput = itemRow.querySelector('.height-input');
                const glassTypeSelect = itemRow.querySelector('.glass-type-select');

                // Check if the elements exist before trying to read their value
                if (!quantityInput || !widthInput || !heightInput || !glassTypeSelect) {
                    hasError = true;
                    return; // Exit the forEach loop
                }
                const selectedGlassKey = glassTypeSelect.value;
                const quantity = parseFloat(quantityInput.value);
                const widthCm = parseFloat(widthInput.value);
                const heightCm = parseFloat(heightInput.value);

                // --- Validation for each item ---
                // We now check for NaN (Not a Number) to handle empty or invalid inputs
                if (isNaN(quantity) || isNaN(widthCm) || isNaN(heightCm) || quantity <= 0 || widthCm <= 0 || heightCm <= 0) {
                    hasError = true;
                }

                if (!hasError) {
                    // Calculate the price for the current item
                    const formulaResult = (widthCm * heightCm) / 900;
                    const pricePerUnit = glassData[selectedGlassKey].price;
                    const itemTotalPrice = formulaResult * pricePerUnit * quantity;
                    totalGeneralPrice += itemTotalPrice;

                    // Add details to the quote
                    quoteDetails.push({
                        type: glassData[selectedGlassKey].name,
                        quantity: quantity,
                        width: widthCm,
                        height: heightCm,
                        price: itemTotalPrice
                    });
                }
            });

            // --- Display result and WhatsApp button ---
            if (hasError) {
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('bg-red-50', 'border-red-300');
                priceDisplay.textContent = 'Error';
                priceDisplay.classList.add('text-red-500');
                messageDisplay.textContent = 'Por favor, asegúrate de que todas las cantidades y dimensiones sean válidas (números mayores a cero).';
                whatsappSection.classList.add('hidden');
            } else {
                resultDiv.classList.remove('hidden', 'bg-red-50', 'border-red-300');
                resultDiv.classList.add('bg-gray-50', 'border-gray-200');
                priceDisplay.classList.remove('text-red-500');

                // Format the total price for display
                const formattedPrice = totalGeneralPrice.toLocaleString('es-PE', {
                    style: 'currency',
                    currency: 'PEN',
                    minimumFractionDigits: 2
                });

                // Update the display elements
                priceDisplay.textContent = formattedPrice;
                messageDisplay.textContent = '';
                whatsappSection.classList.remove('hidden');
            }
        });

        // Event listener for the Review button
        reviewBtn.addEventListener('click', () => {
            const clientName = clientNameInput.value.trim();
            const whatsappNumber = whatsappNumberInput.value.trim();
            if (!clientName || !whatsappNumber) {
                messageDisplay.textContent = 'Por favor, ingresa tu nombre y número de WhatsApp para revisar la cotización.';
                messageDisplay.style.color = 'red';
                return;
            }
            
            // Clear previous review details
            reviewDetails.innerHTML = '';
            
            // Generate review content
            let reviewHtml = '';
            quoteDetails.forEach((item, index) => {
                reviewHtml += `
                    <div class="border-b pb-2 mb-2">
                        <p class="font-bold text-gray-700">Artículo ${index + 1}: <span class="font-normal">${item.type}</span></p>
                        <ul class="text-sm text-gray-500 list-disc list-inside">
                            <li>Cantidad: ${item.quantity}</li>
                            <li>Medidas: ${item.width}cm x ${item.height}cm</li>
                            <li>Subtotal: ${item.price.toLocaleString('es-PE', { style: 'currency', currency: 'PEN' })}</li>
                        </ul>
                    </div>
                `;
            });
            reviewDetails.innerHTML = reviewHtml;
            reviewTotalPrice.textContent = totalGeneralPrice.toLocaleString('es-PE', {
                style: 'currency',
                currency: 'PEN',
                minimumFractionDigits: 2
            });
            
            // Show the modal
            reviewModal.classList.remove('hidden');
        });

        // Event listener to close the modal
        closeModalBtn.addEventListener('click', () => {
            reviewModal.classList.add('hidden');
        });

        // WhatsApp sharing logic (now inside the modal)
        sendWhatsappBtn.addEventListener('click', () => {
            const clientName = clientNameInput.value.trim() || 'Cliente';
            const whatsappNumber = whatsappNumberInput.value.trim();
            const businessNumber = '924563919'; // Business WhatsApp number

            // Build the message
            let message = `¡Hola Vidriería Tauro! Mi nombre es ${clientName} y mi número de WhatsApp es ${whatsappNumber}. Me gustaría solicitar una cotización con los siguientes detalles:\n\n`;
            
            quoteDetails.forEach((item, index) => {
                message += `*Artículo ${index + 1}:*\n`;
                message += `  - Tipo: ${item.type}\n`;
                message += `  - Cantidad: ${item.quantity}\n`;
                message += `  - Medidas: ${item.width}cm x ${item.height}cm\n`;
                message += `  - Precio: ${item.price.toLocaleString('es-PE', { style: 'currency', currency: 'PEN' })}\n\n`;
            });

            message += `*Precio Total Estimado:* ${totalGeneralPrice.toLocaleString('es-PE', { style: 'currency', currency: 'PEN' })}\n\n`;
            message += "Agradecería tu pronta atención.";

            // URL encode the message
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${businessNumber}?text=${encodedMessage}`;

            // Open WhatsApp
            window.open(whatsappUrl, '_blank');
        });
    </script>
</body>
</html>





